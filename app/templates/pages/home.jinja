{% extends "layouts/base.jinja" %}

{% block title %}„Éõ„Éº„É†{% endblock %}

{% block content %}
    <style>
    s-markdown::part(content) {
      color: #333;
      background: #f9f9f9;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.sl-theme-dark s-markdown::part(content) {
  color: #eee;
  background: #1a1a1a;
  border-color: #333;
}
s-markdown::part(content) {
  font-size: 1.2rem;
  color: darkgreen;
  background: #f0f0f0;
}
{# s-page::part(content) {
  padding: 10mm;
  border: 2mm solid black;
} #}

    </style>
    <div id="hidden-preview" style="position: absolute; left: -9999px; top: -9999px; overflow: hidden;"> 
      <s-page id="s-page" debug size="A4" direction="portrait">
        <s-markdown id="s-page"></s-markdown>
      </s-page> 
    </div>
    <sl-split-panel style="height: 100vh;" position="50" horizontal>
      <div slot="start" id="preview-container" style="position: relative; height: 100%; overflow: hidden;background:grey"> 
        <div id="scaled-wrapper" style="transform-origin: top left;overflow-y:auto"></div>
        <!-- üéØ „Ç´„Çπ„Çø„É†„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div id="panzoom-hint" class="panzoom-hint">
          <sl-icon name="chevron-up" style="font-size: 2rem;"></sl-icon>
          <div style="border: 2px dashed #ccc; padding: 1rem 2rem; border-radius: 8px;">
            <sl-icon name="mouse" style="font-size: 2rem;"></sl-icon>
          </div>
          <sl-icon name="chevron-down" style="font-size: 2rem;"></sl-icon>
          <p style="margin-top: 1rem; color: #666;">„Éû„Ç¶„Çπ„Éõ„Ç§„Éº„É´„ÅßÊã°Â§ß„ÉªÁ∏ÆÂ∞è„Åß„Åç„Åæ„Åô</p>
        </div>
      </div>
      <div slot="end" style="height: 100vh; display: flex; flex-direction: column;">
        <div style="height:3rem;width:100vw">
        <div class="button-group-toolbar">
  <sl-button-group label="History">
    <sl-tooltip content="Undo">
      <sl-button><sl-icon name="arrow-counterclockwise" label="Undo"></sl-icon></sl-button>
    </sl-tooltip>
    <sl-tooltip content="Redo">
      <sl-button><sl-icon name="arrow-clockwise" label="Redo"></sl-icon></sl-button>
    </sl-tooltip>
  </sl-button-group>

  <sl-button-group label="Formatting">
    <sl-tooltip content="Bold">
      <sl-button><sl-icon name="type-bold" label="Bold"></sl-icon></sl-button>
    </sl-tooltip>
    <sl-tooltip content="Italic">
      <sl-button><sl-icon name="type-italic" label="Italic"></sl-icon></sl-button>
    </sl-tooltip>
    <sl-tooltip content="Underline">
      <sl-button><sl-icon name="type-underline" label="Underline"></sl-icon></sl-button>
    </sl-tooltip>
  </sl-button-group>

  <sl-button-group label="Alignment">
    <sl-tooltip content="Align Left">
      <sl-button><sl-icon name="justify-left" label="Align Left"></sl-icon></sl-button>
    </sl-tooltip>
    <sl-tooltip content="Align Center">
      <sl-button><sl-icon name="justify" label="Align Center"></sl-icon></sl-button>
    </sl-tooltip>
    <sl-tooltip content="Align Right">
      <sl-button><sl-icon name="justify-right" label="Align Right"></sl-icon></sl-button>
    </sl-tooltip>
  </sl-button-group>
</div>


        </div>
        <textarea id="editor" style="flex: 1;"></textarea>
      </div>
    </sl-split-panel>
{% endblock %}
{% block script %}
<style>
  .button-group-toolbar sl-button-group:not(:last-of-type) {
    margin-right: var(--sl-spacing-x-small);
  }
</style>

<script>
const textarea = document.getElementById('editor');
const sPage = document.getElementById('s-page');
const wrapper = document.getElementById('scaled-wrapper');

const dialog = document.getElementById('panzoom-hint');
dialog.style.display = 'flex';

textarea.addEventListener('input', () => {
  sPage.innerHTML = textarea.value;

  sPage.dispatchEvent(new CustomEvent('content-updated', {
    bubbles: true,
    composed: true
  }));
});

// ÂàùÊúüÂåñÔºös-page „Çí wrapper „Å´ÁßªÂãï„Åó„Å¶„Çπ„Ç±„Éº„É™„É≥„Ç∞
wrapper.appendChild(sPage);

function scalePreview() {
  const container = document.getElementById('preview-container');
  const pageEl = sPage.shadowRoot?.querySelector('.page');
  if (!pageEl) return;
  const containerWidth = container.clientWidth;
  const scale = containerWidth / pageEl.offsetWidth;
 console.log(containerWidth);

  wrapper.style.transform = `scale(${scale})`;
}

window.addEventListener('resize', scalePreview);
window.addEventListener('load', scalePreview);

const pan = Panzoom(wrapper, {
    maxScale: 3,
    minScale: 0.1,
    contain: 'contain'
  });

wrapper.parentElement.addEventListener('wheel', pan.zoomWithWheel);
dialog.addEventListener('click', () => {
  dialog.style.display = 'none';
});


</script>
{% endblock %}
